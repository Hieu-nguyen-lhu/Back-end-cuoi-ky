<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi Ti·∫øt ƒê∆°n H√†ng</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <h1>üõçÔ∏è Qu·∫£n L√Ω B√°n H√†ng</h1>
            <div id="navMenu" class="nav-menu">
                <a href="index.html" class="nav-link">Trang Ch·ªß</a>
                <a href="products.html" class="nav-link" id="navProducts" style="display:none;">S·∫£n Ph·∫©m</a>
                <a href="admin-products.html" class="nav-link" id="navAdmin" style="display:none;">Qu·∫£n L√Ω S·∫£n Ph·∫©m</a>
                <a href="my-orders.html" class="nav-link" id="navMyOrders" style="display:none;">ƒê∆°n H√†ng C·ªßa T√¥i</a>
                <a href="cart.html" class="nav-link" id="navCart" style="display:none;">
                    üõí Gi·ªè H√†ng <span id="cartCount" class="badge">0</span>
                </a>
                <button id="logoutBtn" class="btn btn-danger" style="display:none;">ƒêƒÉng Xu·∫•t</button>
            </div>
        </div>
    </nav>

    <div class="container">
        <h2>Chi Ti·∫øt ƒê∆°n H√†ng</h2>
        
        <div id="orderContainer" style="display:none;">
            <div class="order-info">
                <p><strong>ID ƒê∆°n H√†ng:</strong> <span id="orderId"></span></p>
                <p><strong>Kh√°ch H√†ng:</strong> <span id="customerName"></span></p>
                <p><strong>Ng√†y T·∫°o:</strong> <span id="orderDate"></span></p>
                <p><strong>Tr·∫°ng Th√°i:</strong> <span id="orderStatus"></span></p>
            </div>

            <table class="table">
                <thead>
                    <tr>
                        <th>S·∫£n Ph·∫©m</th>
                        <th>Gi√°</th>
                        <th>S·ªë L∆∞·ª£ng</th>
                        <th>Th√†nh Ti·ªÅn</th>
                    </tr>
                </thead>
                <tbody id="orderDetails">
                </tbody>
            </table>

            <div class="order-summary">
                <h3>T·ªïng Ti·ªÅn: <span id="totalAmount">0</span> VNƒê</h3>
            </div>

            <div style="margin-top: 20px;">
                <a href="products.html" class="btn btn-primary">Ti·∫øp T·ª•c Mua S·∫Øm</a>
            </div>
        </div>

        <div id="loadingMessage" class="message message-info">
            ƒêang t·∫£i chi ti·∫øt ƒë∆°n h√†ng...
        </div>

        <div id="errorMessage" class="message message-error" style="display:none;">
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth('User');
            loadOrderDetail();
            updateNavigation();
        });

        function getOrderIdFromUrl() {
            const params = new URLSearchParams(window.location.search);
            return params.get('id');
        }

        async function loadOrderDetail() {
            const orderId = getOrderIdFromUrl();
            
            if (!orderId) {
                showError('Kh√¥ng t√¨m th·∫•y ID ƒë∆°n h√†ng');
                return;
            }

            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_URL}/orders/${orderId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng');
                }

                const data = await response.json();
                const order = data.data;

                document.getElementById('orderId').textContent = order.id;
                document.getElementById('customerName').textContent = order.customerName;
                document.getElementById('orderDate').textContent = new Date(order.orderDate).toLocaleString('vi-VN');
                document.getElementById('orderStatus').textContent = order.status;
                document.getElementById('totalAmount').textContent = order.totalAmount.toLocaleString('vi-VN');

                const orderDetailsBody = document.getElementById('orderDetails');
                orderDetailsBody.innerHTML = '';

                if (order.orderDetails && order.orderDetails.length > 0) {
                    order.orderDetails.forEach(detail => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${detail.productName}</td>
                            <td>${detail.unitPrice.toLocaleString('vi-VN')} VNƒê</td>
                            <td>${detail.quantity}</td>
                            <td>${detail.subtotal.toLocaleString('vi-VN')} VNƒê</td>
                        `;
                        orderDetailsBody.appendChild(row);
                    });
                }

                document.getElementById('loadingMessage').style.display = 'none';
                document.getElementById('orderContainer').style.display = 'block';
            } catch (error) {
                console.error('L·ªói:', error);
                showError(error.message);
            }
        }

        function showError(message) {
            document.getElementById('loadingMessage').style.display = 'none';
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorMessage').style.display = 'block';
        }
    </script>
</body>
</html>
